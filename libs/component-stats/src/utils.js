"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.filterByMinUsage = filterByMinUsage;
exports.getUnusedComponents = getUnusedComponents;
exports.getLibraryComponents = getLibraryComponents;
exports.getLocalComponents = getLocalComponents;
exports.groupBySource = groupBySource;
exports.getTopComponents = getTopComponents;
exports.findUsedBy = findUsedBy;
exports.generateReport = generateReport;
exports.toCSV = toCSV;
/**
 * Filter components by minimum usage count
 */
function filterByMinUsage(stats, minCount) {
    return stats.filter(c => c.count >= minCount);
}
/**
 * Get only unused components
 */
function getUnusedComponents(stats) {
    return stats.filter(c => c.count === 0);
}
/**
 * Get components from external libraries (node_modules)
 */
function getLibraryComponents(stats) {
    return stats.filter(c => c.source.includes('node_modules') || c.source.startsWith('@'));
}
/**
 * Get local project components
 */
function getLocalComponents(stats) {
    return stats.filter(c => !c.source.includes('node_modules') && !c.source.startsWith('@'));
}
/**
 * Group components by source (library or path)
 */
function groupBySource(stats) {
    const grouped = new Map();
    for (const stat of stats) {
        const source = stat.source;
        if (!grouped.has(source)) {
            grouped.set(source, []);
        }
        grouped.get(source).push(stat);
    }
    return grouped;
}
/**
 * Get top N most used components
 */
function getTopComponents(stats, limit = 10) {
    return stats
        .filter(c => c.count > 0)
        .sort((a, b) => b.count - a.count)
        .slice(0, limit);
}
/**
 * Find components used by a specific component
 */
function findUsedBy(stats, componentClass) {
    return stats.filter(c => c.usedIn.includes(componentClass));
}
/**
 * Generate a simple text report
 */
function generateReport(stats) {
    const lines = [];
    lines.push('Angular Component Usage Report');
    lines.push('==============================\n');
    const totalComponents = stats.length;
    const usedComponents = stats.filter(c => c.count > 0).length;
    const unusedComponents = stats.filter(c => c.count === 0).length;
    const totalUsages = stats.reduce((sum, c) => sum + c.count, 0);
    lines.push('Summary:');
    lines.push(`  Total components: ${totalComponents}`);
    lines.push(`  Used components: ${usedComponents}`);
    lines.push(`  Unused components: ${unusedComponents}`);
    lines.push(`  Total usages: ${totalUsages}`);
    lines.push('');
    const topComponents = getTopComponents(stats, 5);
    if (topComponents.length > 0) {
        lines.push('Top 5 Most Used Components:');
        topComponents.forEach((c, i) => {
            lines.push(`  ${i + 1}. ${c.componentClass} - ${c.count} usage(s)`);
        });
        lines.push('');
    }
    const unused = getUnusedComponents(stats);
    if (unused.length > 0) {
        lines.push(`Unused Components (${unused.length}):`);
        unused.slice(0, 10).forEach(c => {
            lines.push(`  - ${c.componentClass} (${c.source})`);
        });
        if (unused.length > 10) {
            lines.push(`  ... and ${unused.length - 10} more`);
        }
        lines.push('');
    }
    const libraryComponents = getLibraryComponents(stats);
    if (libraryComponents.length > 0) {
        lines.push(`Library Components (${libraryComponents.length}):`);
        const byLib = groupBySource(libraryComponents);
        for (const [lib, components] of byLib) {
            const totalLibUsage = components.reduce((sum, c) => sum + c.count, 0);
            lines.push(`  ${lib}: ${components.length} component(s), ${totalLibUsage} usage(s)`);
        }
    }
    return lines.join('\n');
}
/**
 * Export to CSV format
 */
function toCSV(stats) {
    const lines = [];
    lines.push('Component Class,Source,Usage Count,Used In');
    for (const stat of stats) {
        const usedIn = stat.usedIn.join('; ');
        lines.push(`"${stat.componentClass}","${stat.source}",${stat.count},"${usedIn}"`);
    }
    return lines.join('\n');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLDRDQUVDO0FBS0Qsa0RBRUM7QUFLRCxvREFFQztBQUtELGdEQUVDO0FBS0Qsc0NBWUM7QUFLRCw0Q0FLQztBQUtELGdDQUVDO0FBS0Qsd0NBa0RDO0FBS0Qsc0JBVUM7QUFsSUQ7O0dBRUc7QUFDSCxTQUFnQixnQkFBZ0IsQ0FBQyxLQUF1QixFQUFFLFFBQWdCO0lBQ3hFLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLENBQUM7QUFDaEQsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsbUJBQW1CLENBQUMsS0FBdUI7SUFDekQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixvQkFBb0IsQ0FBQyxLQUF1QjtJQUMxRCxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQzFGLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGtCQUFrQixDQUFDLEtBQXVCO0lBQ3hELE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQzVGLENBQUM7QUFFRDs7R0FFRztBQUNI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S0FBSyxHQUFHLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQy9DLEtBQUssTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUN0QyxNQUFNLGFBQWEsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdEUsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxVQUFVLENBQUMsTUFBTSxrQkFBa0IsYUFBYSxXQUFXLENBQUMsQ0FBQztRQUN2RixDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixLQUFLLENBQUMsS0FBdUI7SUFDM0MsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO0lBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztJQUV6RCxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRSxDQUFDO1FBQ3pCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsY0FBYyxNQUFNLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLEtBQUssS0FBSyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BGLENBQUM7SUFFRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudFN0YXRzIH0gZnJvbSAnLi90eXBlcyc7XG5cbi8qKlxuICogRmlsdGVyIGNvbXBvbmVudHMgYnkgbWluaW11bSB1c2FnZSBjb3VudFxuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyQnlNaW5Vc2FnZShzdGF0czogQ29tcG9uZW50U3RhdHNbXSwgbWluQ291bnQ6IG51bWJlcik6IENvbXBvbmVudFN0YXRzW10ge1xuICByZXR1cm4gc3RhdHMuZmlsdGVyKGMgPT4gYy5jb3VudCA+PSBtaW5Db3VudCk7XG59XG5cbi8qKlxuICogR2V0IG9ubHkgdW51c2VkIGNvbXBvbmVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFVudXNlZENvbXBvbmVudHMoc3RhdHM6IENvbXBvbmVudFN0YXRzW10pOiBDb21wb25lbnRTdGF0c1tdIHtcbiAgcmV0dXJuIHN0YXRzLmZpbHRlcihjID0+IGMuY291bnQgPT09IDApO1xufVxuXG4vKipcbiAqIEdldCBjb21wb25lbnRzIGZyb20gZXh0ZXJuYWwgbGlicmFyaWVzIChub2RlX21vZHVsZXMpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRMaWJyYXJ5Q29tcG9uZW50cyhzdGF0czogQ29tcG9uZW50U3RhdHNbXSk6IENvbXBvbmVudFN0YXRzW10ge1xuICByZXR1cm4gc3RhdHMuZmlsdGVyKGMgPT4gYy5zb3VyY2UuaW5jbHVkZXMoJ25vZGVfbW9kdWxlcycpIHx8IGMuc291cmNlLnN0YXJ0c1dpdGgoJ0AnKSk7XG59XG5cbi8qKlxuICogR2V0IGxvY2FsIHByb2plY3QgY29tcG9uZW50c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TG9jYWxDb21wb25lbnRzKHN0YXRzOiBDb21wb25lbnRTdGF0c1tdKTogQ29tcG9uZW50U3RhdHNbXSB7XG4gIHJldHVybiBzdGF0cy5maWx0ZXIoYyA9PiAhYy5zb3VyY2UuaW5jbHVkZXMoJ25vZGVfbW9kdWxlcycpICYmICFjLnNvdXJjZS5zdGFydHNXaXRoKCdAJykpO1xufVxuXG4vKipcbiAqIEdyb3VwIGNvbXBvbmVudHMgYnkgc291cmNlIChsaWJyYXJ5IG9yIHBhdGgpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBncm91cEJ5U291cmNlKHN0YXRzOiBDb21wb25lbnRTdGF0c1tdKTogTWFwPHN0cmluZywgQ29tcG9uZW50U3RhdHNbXT4ge1xuICBjb25zdCBncm91cGVkID0gbmV3IE1hcDxzdHJpbmcsIENvbXBvbmVudFN0YXRzW10+KCk7XG4gIFxuICBmb3IgKGNvbnN0IHN0YXQgb2Ygc3RhdHMpIHtcbiAgICBjb25zdCBzb3VyY2UgPSBzdGF0LnNvdXJjZTtcbiAgICBpZiAoIWdyb3VwZWQuaGFzKHNvdXJjZSkpIHtcbiAgICAgIGdyb3VwZWQuc2V0KHNvdXJjZSwgW10pO1xuICAgIH1cbiAgICBncm91cGVkLmdldChzb3VyY2UpIS5wdXNoKHN0YXQpO1xuICB9XG4gIFxuICByZXR1cm4gZ3JvdXBlZDtcbn1cblxuLyoqXG4gKiBHZXQgdG9wIE4gbW9zdCB1c2VkIGNvbXBvbmVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRvcENvbXBvbmVudHMoc3RhdHM6IENvbXBvbmVudFN0YXRzW10sIGxpbWl0OiBudW1iZXIgPSAxMCk6IENvbXBvbmVudFN0YXRzW10ge1xuICByZXR1cm4gc3RhdHNcbiAgICAuZmlsdGVyKGMgPT4gYy5jb3VudCA+IDApXG4gICAgLnNvcnQoKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50KVxuICAgIC5zbGljZSgwLCBsaW1pdCk7XG59XG5cbi8qKlxuICogRmluZCBjb21wb25lbnRzIHVzZWQgYnkgYSBzcGVjaWZpYyBjb21wb25lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZpbmRVc2VkQnkoc3RhdHM6IENvbXBvbmVudFN0YXRzW10sIGNvbXBvbmVudENsYXNzOiBzdHJpbmcpOiBDb21wb25lbnRTdGF0c1tdIHtcbiAgcmV0dXJuIHN0YXRzLmZpbHRlcihjID0+IGMudXNlZEluLmluY2x1ZGVzKGNvbXBvbmVudENsYXNzKSk7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgYSBzaW1wbGUgdGV4dCByZXBvcnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlUmVwb3J0KHN0YXRzOiBDb21wb25lbnRTdGF0c1tdKTogc3RyaW5nIHtcbiAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gW107XG4gIFxuICBsaW5lcy5wdXNoKCdBbmd1bGFyIENvbXBvbmVudCBVc2FnZSBSZXBvcnQnKTtcbiAgbGluZXMucHVzaCgnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XFxuJyk7XG4gIFxuICBjb25zdCB0b3RhbENvbXBvbmVudHMgPSBzdGF0cy5sZW5ndGg7XG4gIGNvbnN0IHVzZWRDb21wb25lbnRzID0gc3RhdHMuZmlsdGVyKGMgPT4gYy5jb3VudCA+IDApLmxlbmd0aDtcbiAgY29uc3QgdW51c2VkQ29tcG9uZW50cyA9IHN0YXRzLmZpbHRlcihjID0+IGMuY291bnQgPT09IDApLmxlbmd0aDtcbiAgY29uc3QgdG90YWxVc2FnZXMgPSBzdGF0cy5yZWR1Y2UoKHN1bSwgYykgPT4gc3VtICsgYy5jb3VudCwgMCk7XG4gIFxuICBsaW5lcy5wdXNoKCdTdW1tYXJ5OicpO1xuICBsaW5lcy5wdXNoKGAgIFRvdGFsIGNvbXBvbmVudHM6ICR7dG90YWxDb21wb25lbnRzfWApO1xuICBsaW5lcy5wdXNoKGAgIFVzZWQgY29tcG9uZW50czogJHt1c2VkQ29tcG9uZW50c31gKTtcbiAgbGluZXMucHVzaChgICBVbnVzZWQgY29tcG9uZW50czogJHt1bnVzZWRDb21wb25lbnRzfWApO1xuICBsaW5lcy5wdXNoKGAgIFRvdGFsIHVzYWdlczogJHt0b3RhbFVzYWdlc31gKTtcbiAgbGluZXMucHVzaCgnJyk7XG4gIFxuICBjb25zdCB0b3BDb21wb25lbnRzID0gZ2V0VG9wQ29tcG9uZW50cyhzdGF0cywgNSk7XG4gIGlmICh0b3BDb21wb25lbnRzLmxlbmd0aCA+IDApIHtcbiAgICBsaW5lcy5wdXNoKCdUb3AgNSBNb3N0IFVzZWQgQ29tcG9uZW50czonKTtcbiAgICB0b3BDb21wb25lbnRzLmZvckVhY2goKGMsIGkpID0+IHtcbiAgICAgIGxpbmVzLnB1c2goYCAgJHtpICsgMX0uICR7Yy5jb21wb25lbnRDbGFzc30gLSAke2MuY291bnR9IHVzYWdlKHMpYCk7XG4gICAgfSk7XG4gICAgbGluZXMucHVzaCgnJyk7XG4gIH1cbiAgXG4gIGNvbnN0IHVudXNlZCA9IGdldFVudXNlZENvbXBvbmVudHMoc3RhdHMpO1xuICBpZiAodW51c2VkLmxlbmd0aCA+IDApIHtcbiAgICBsaW5lcy5wdXNoKGBVbnVzZWQgQ29tcG9uZW50cyAoJHt1bnVzZWQubGVuZ3RofSk6YCk7XG4gICAgdW51c2VkLnNsaWNlKDAsIDEwKS5mb3JFYWNoKGMgPT4ge1xuICAgICAgbGluZXMucHVzaChgICAtICR7Yy5jb21wb25lbnRDbGFzc30gKCR7Yy5zb3VyY2V9KWApO1xuICAgIH0pO1xuICAgIGlmICh1bnVzZWQubGVuZ3RoID4gMTApIHtcbiAgICAgIGxpbmVzLnB1c2goYCAgLi4uIGFuZCAke3VudXNlZC5sZW5ndGggLSAxMH0gbW9yZWApO1xuICAgIH1cbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgfVxuICBcbiAgY29uc3QgbGlicmFyeUNvbXBvbmVudHMgPSBnZXRMaWJyYXJ5Q29tcG9uZW50cyhzdGF0cyk7XG4gIGlmIChsaWJyYXJ5Q29tcG9uZW50cy5sZW5ndGggPiAwKSB7XG4gICAgbGluZXMucHVzaChgTGlicmFyeSBDb21wb25lbnRzICgke2xpYnJhcnlDb21wb25lbnRzLmxlbmd0aH0pOmApO1xuICAgIGNvbnN0IGJ5TGliID0gZ3JvdXBCeVNvdXJjZShsaWJyYXJ5Q29tcG9uZW50cyk7XG4gICAgZm9yIChjb25zdCBbbGliLCBjb21wb25lbnRzXSBvZiBieUxpYikge1xuICAgICAgY29uc3QgdG90YWxMaWJVc2FnZSA9IGNvbXBvbmVudHMucmVkdWNlKChzdW0sIGMpID0+IHN1bSArIGMuY291bnQsIDApO1xuICAgICAgbGluZXMucHVzaChgICAke2xpYn06ICR7Y29tcG9uZW50cy5sZW5ndGh9IGNvbXBvbmVudChzKSwgJHt0b3RhbExpYlVzYWdlfSB1c2FnZShzKWApO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xufVxuXG4vKipcbiAqIEV4cG9ydCB0byBDU1YgZm9ybWF0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0NTVihzdGF0czogQ29tcG9uZW50U3RhdHNbXSk6IHN0cmluZyB7XG4gIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICBsaW5lcy5wdXNoKCdDb21wb25lbnQgQ2xhc3MsU291cmNlLFVzYWdlIENvdW50LFVzZWQgSW4nKTtcbiAgXG4gIGZvciAoY29uc3Qgc3RhdCBvZiBzdGF0cykge1xuICAgIGNvbnN0IHVzZWRJbiA9IHN0YXQudXNlZEluLmpvaW4oJzsgJyk7XG4gICAgbGluZXMucHVzaChgXCIke3N0YXQuY29tcG9uZW50Q2xhc3N9XCIsXCIke3N0YXQuc291cmNlfVwiLCR7c3RhdC5jb3VudH0sXCIke3VzZWRJbn1cImApO1xuICB9XG4gIFxuICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG59XG4iXX0=